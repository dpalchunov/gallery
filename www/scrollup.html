<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>jquery: поднятие страницы наверх, плавное появление\ичезание кнопки</title>
  <meta http-equiv="content-type" content="text/html;charset=windows-1251" />
  <script src="../js/jquery.js"></script>

<style>
	.uBlock {
    border: 1px solid #333333;
    width:500px;
    padding:15px;
		}
    #upBlock {
        position:fixed;
        bottom:15px;
        right:15px;
        color:#000000;
        padding:6px;
        text-align:center;
        z-index:9999999999;
        display:none;
        }
</style>


<script>
var thisPageNum = 1;
var thisWork = 1;
//функция получает следующую страницу
function getNextP(){
  if(thisWork == 1){
    //флаг позволяет запускать функцию сключительно последовательно
    thisWork = 0;
    //отображаем указатель загрузки	
    $("#upBlock").css('display','block');
    //запрашиваем данные у страницы get.php
    //передаём ей
    //	page=+thisPageNum
    //получаем от неё
    //	data
    //data обрабатываем в функции
    //	function
    $.get("get.php?page="+thisPageNum,
	  //функция обработки полученных данных
	  function(data){
	    //скрываем индикатор загрузки
	    $("#upBlock").css('display','none');
	    //берем то что уже есть между тегами блока LoadDiv
	    //прибавляем к этому новые данные
	    //и устанавливаем то тчо получилось тому же LoadDiv между тегами
	    $("#LoadDiv").html($("#LoadDiv").html()+" "+data);
	    //увеличиваем переменную, чтобы потом передавать ей в страницу формирования новых данных
	    thisPageNum = thisPageNum + 1;
	    //флаг позволяет запускать функцию сключительно последовательно
	    thisWork = 1;
	  }
    );
  }
}

$(document).ready(function(){
  var scrH = $(window).height();
  var scrHP = $("#container").height();
 
  $(window).scroll(function(){
		    // number of window pixels that are hidden from view above
		    var scro = $(this).scrollTop();
		    //высота всех блоков вместе
		    var scrHP = $("#container").height();
		    var scrH2 = 0;
		    //расстояния от самого верха страницы до самого низа отображаемого  онка
		    scrH2 = scrH + scro;
		    //расстояния которое осталось прокрутить до низу, чтобы странца закончилась
		    //здесь еще надо учесть ту чать которая над контейнером +header.height
		    var leftH = scrHP/*+header.height*/ - scrH2;
		
		    if(leftH < 300){
			     getNextP();
		    }
		  });
});
</script>
</head>

<body>
<h2><a href="../blog80.html">jquery: автоматическая загрузка блоков при прокрутке страницы вниз (пример)</a></h2>
<div id="upBlock"><img src="img/loader.gif" border="0" /></div>
<div id="container"><div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №1<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №2<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №3<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №4<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №5<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №6<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №7<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №8<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №9<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>

<div class="uBlock">
Андрей <b>01,01,2011</b><br /><br />
Это тестовый комментарий №10<br />
Это текст для объема Это текст для объема<br />
Это текст для объема Это текст для объема
</div>
<div id="LoadDiv"></div>

</div>
</body>

</html>